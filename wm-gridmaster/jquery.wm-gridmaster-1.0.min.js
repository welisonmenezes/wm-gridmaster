/*!
 * jquery.wm-gridmaster - v 1.0
 * desenvolvido por Welison Menezes
 * email : welisonmenezes@gmail.com
 * 
 *
 * Copyright 2014 Welison Menezes
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 * @license http://www.gnu.org/licenses/gpl.html GPL2 License 
 */
!function(t){var e,a,o={cols:8,close_button_text:"X",next_button_text:"&gt;",prev_button_text:"&lt;",go_to_type:"middle-thumb",has_detail:!0,has_navigation:!0,navigation_position:"middle",thumbs_height:"equal-width",spaces:{padding:5,wrap:!0},arrow_detail:{has_arrow:!0,arrow_size:10},speeds:{content_down:300,content_up:300,go_to_opened:200},ajax:{has_ajax:!1,method:"GET",data:{},url:"",button_text:"Add Mais",load_content:"carregando...",has_ajax_detail:!1,method_detail:"GET",data_detail:{},url_detail:"",load_content_detail:"carregando..."},selectors:{grid_has_opened:"wm-grid-has-opened",wrap:"wm-grid-wrap",item:"wm-grid-item",thumbs:"wm-grid-thumb",item_opened:"wm-grid-item-opened",items_last_row:"wm-grid-of-last-row",content:"wm-grid-content",body_content:"wm-grid-body",button_close:"wm-grid-close",button_next:"wm-grid-next",button_prev:"wm-grid-prev",arrow_detail:"wm-grid-arrow",ajax_button_container:"wm-grid-action",ajax_button:"wm-grid-add-more",ajax_load_container:"wm-grid-loading"},callbacks:{CB_beforeInitGrid:!1,CB_afterInitGrid:!1,CB_beforeLoadAjax:!1,CB_afterLoadAjax:!1,CB_beforeOpenDetail:!1,CB_afterOpenDetail:!1,CB_beforeAjaxOpenDetail:!1,CB_afterAjaxOpenDetail:!1,CB_closeDetail:!1,CB_nextDetail:!1,CB_prevDetail:!1,CB_goToDetail:!1},responsive:[{size:992,options:{cols:6,spaces:{padding:3,wrap:!0},thumbs_height:"equal-width"}},{size:768,options:{cols:4,spaces:{padding:2,wrap:!0},thumbs_height:"equal-width"}},{size:400,options:{cols:2,spaces:{padding:1,wrap:!0},thumbs_height:"equal-width"}}]},n=function(){for(var a=e.cols,o=t(window).width(),n=e.responsive,i=n.length,s=0;i>s;s++)n[s].size&&o<=n[s].size&&n[s].options.cols&&(a=n[s].options.cols);return a},i=function(){for(var a=e.spaces.padding,o=t(window).width(),n=e.responsive,i=n.length,s=0;i>s;s++)n[s].size&&o<=n[s].size&&n[s].options.spaces.padding&&(a=n[s].options.spaces.padding);return a},s=function(){var a=e.thumbs_height,o=t(window).width();"equal-width"===a?a="equal-width":"row-equal-width"===a?a="row-equal-width":a+=e.spaces.padding;for(var n=e.responsive,i=n.length,s=0;i>s;s++)n[s].size&&o<=n[s].size&&n[s].options.thumbs_height&&(a=n[s].options.thumbs_height,"equal-width"===a?a="equal-width":"row-equal-width"===a?a="row-equal-width":n[s].options.spaces.padding&&(a+=n[s].options.spaces.padding));return a},r=function(){for(var a=e.spaces.wrap,o=t(window).width(),n=e.responsive,i=n.length,s=0;i>s;s++)n[s].size&&o<=n[s].size&&n[s].options.spaces.wrap&&(a=n[s].options.spaces.wrap);return a},l=function(a){var o=a,l=o.find("."+e.selectors.wrap);$itens=l.find("."+e.selectors.item);var c=n(),p=s(),h=100/c,f=i(),m=r();$itens.length;"equal-width"===p&&(p=Math.floor(l.width()/c)),m?l.css({"padding-top":f+"px"}):l.css({"padding-top":"0px"});var g=1,b=1,x=1,w=[],v=[],C=1,B=Math.ceil($itens.length/c);if("row-equal-width"===p){var j=1,D=1;$itens.each(function(){var a=t(this),o=a.find("."+e.selectors.thumbs);if(a.css({height:"auto"}),o.css({height:"auto"}),w.push(a.height()),x==D&&j==c){var n=Math.max.apply(null,w);v.push(n),w=[],x++}j==c?(j=1,D++):j++})}$itens.each(function(){var a,o=t(this),n=o.find("."+e.selectors.thumbs);a="row-equal-width"===p&&v[b-1]?v[b-1]:p,o.css({width:h+"%",height:a+"px"}),n.css({"margin-left":f/2+"px","margin-right":f/2+"px","margin-bottom":f+"px",height:a-f+"px"}),1==g&&(m?n.css({"margin-left":f+"px"}):n.css({"margin-left":"0px"})),g==c&&(m?n.css({"margin-right":f+"px"}):n.css({"margin-right":"0px"})),b>=B&&!m&&(n.css({"margin-bottom":"0px"}),o.css({height:a-f+"px"})),b>=B?(n.addClass(e.selectors.items_last_row),o.addClass(e.selectors.items_last_row)):(n.removeClass(e.selectors.items_last_row),o.removeClass(e.selectors.items_last_row)),g==c?(g=1,b++):g++,C++,e.has_detail&&(d(o),e.has_navigation&&(_(o),u(o)))})},c=function(a){var o=a;if(o.find("."+e.selectors.ajax_button_container).length<1){var n=t('<div class="'+e.selectors.ajax_button_container+'" />'),i=t('<a href="'+e.ajax.url+'" class="'+e.selectors.ajax_button+'" title="'+e.ajax.button_text+'">'+e.ajax.button_text+"</a>");n.html(i),o.append(n)}},p=function(a){var o=a;if(o.find("."+e.selectors.ajax_load_container).length<1){var n,i=t('<div class="'+e.selectors.ajax_load_container+'" />');try{n=t(e.ajax.load_content)}catch(s){n=e.ajax.load_content}i.html(n),o.append(i)}},d=function(t){var a=t,o=a.find("."+e.selectors.content),n=o.find("."+e.selectors.button_close),i=o.find("."+e.selectors.arrow_detail);if(n.length<1){var s='<span class="'+e.selectors.button_close+'">'+e.close_button_text+"</span>";o.prepend(s)}if(e.arrow_detail.has_arrow&&i.length<1){var r='<span class="'+e.selectors.arrow_detail+'"></span>';o.prepend(r)}},_=function(t){var a=t,o=a.find("."+e.selectors.content),n=o.find("."+e.selectors.button_next);if(n.length<1){var i='<span class="'+e.selectors.button_next+'">'+e.next_button_text+"</span>";o.append(i)}},u=function(t){var a=t,o=a.find("."+e.selectors.content),n=o.find("."+e.selectors.button_prev);if(n.length<1){var i='<span class="'+e.selectors.button_prev+'">'+e.prev_button_text+"</span>";o.append(i)}},h=function(){t("body").on("click","."+e.selectors.ajax_button,function(o){o.preventDefault();var n=t(this),i=n.attr("href")?n.attr("href"):e.ajax.url,s=n.parent(),r=s.parent(),c=r.find("."+e.selectors.wrap),p=r.find("."+e.selectors.ajax_load_container);return s.hide(),p.show(),a.CB_beforeLoadAjax(),t.ajax({method:e.ajax.method,url:i,data:e.ajax.data}).done(function(o){var n=t(o).filter("."+e.selectors.item).length;n>0?(c.append(o),l(r),D(r),s.show(),p.hide()):(s.hide(),p.hide()),a.CB_afterLoadAjax()}),!1})},f=function(o){a.CB_beforeOpenDetail();var n=o,i=n.parent().find("."+e.selectors.item+"."+e.selectors.item_opened),s=i.find("."+e.selectors.content);if(e.has_detail&&n.parent().parent().parent().addClass(e.selectors.grid_has_opened),i.length>0?(i.removeClass(e.selectors.item_opened),s.hide(),w(n,!1)):w(n,!0),e.ajax.has_ajax_detail){var r=n.find("."+e.selectors.body_content),l=r.attr("data-ajax-url")?r.attr("data-ajax-url"):e.ajax.url_detail;""==t.trim(r.html())&&(a.CB_beforeAjaxOpenDetail(),r.html(e.ajax.load_content_detail),w(n,!1),t.ajax({method:e.ajax.method_detail,url:l,data:e.ajax.data_detail}).done(function(t){r.html(t),i.length>0?w(n,!1):w(n,!0),a.CB_afterAjaxOpenDetail()}))}a.CB_afterOpenDetail()},m=function(){t("body").on("click","."+e.selectors.thumbs,function(e){e.preventDefault();var a=t(this).parent();return f(a),!1})},g=function(){t("body").on("click","."+e.selectors.button_next,function(e){e.preventDefault();var o=t(this),n=o.parent().parent();return n.next().length>0&&(f(n.next()),a.CB_nextDetail()),!1})},b=function(){t("body").on("click","."+e.selectors.button_prev,function(e){e.preventDefault();var o=t(this),n=o.parent().parent();return n.prev().length>0&&(f(n.prev()),a.CB_prevDetail()),!1})},x=function(t,o){var n=t,i=o,s=n.find("."+e.selectors.item).eq(i);s.length>0&&(f(s),a.CB_goToDetail())},w=function(t,a){var o=t,n=o.find("."+e.selectors.content);y(o),a?(v(o,!0),n.slideDown(e.speeds.content_down,function(){o.addClass(e.selectors.item_opened),v(o,!0),y(o),A(o)})):(v(o,!1),n.show(),o.addClass(e.selectors.item_opened),v(o,!1),y(o),A(o)),k(o)},v=function(a,o){var n=a,s=n.find("."+e.selectors.content),l=n.parent().find("."+e.selectors.item),c=n.offset().top,p=s.height()+i();l.each(function(){var a=t(this),n=a.find("."+e.selectors.content);a.offset().top==c?o?a.stop().animate({"margin-bottom":p+"px"},e.speeds.content_down):a.css({"margin-bottom":p+"px"}):a.css({"margin-bottom":"0px"}),a.hasClass(e.selectors.items_last_row)?r()?n.css({"margin-top":"0px"}):n.css({"margin-top":i()+"px"}):n.css({"margin-top":"0px"})})},C=function(a,o){var n=a,i=n.parent().find("."+e.selectors.item),s=0;i.each(function(){var a=t(this);o?a.stop().animate({"margin-bottom":s+"px"},e.speeds.content_up):a.css({"margin-bottom":s+"px"})})},B=function(t){var o=t,n=o.find("."+e.selectors.content),i=n.parent().parent().parent().parent();i.removeClass(e.selectors.grid_has_opened),n.slideUp(e.speeds.content_up,function(){o.removeClass(e.selectors.item_opened)}),C(o,!0),a.CB_closeDetail()},j=function(){t("body").on("click","."+e.selectors.button_close,function(e){e.preventDefault();var a=t(this),o=a.parent().parent();return B(o),!1})},D=function(t){var a=t,o=a.find("."+e.selectors.item+"."+e.selectors.item_opened);o.length>0&&(v(o,!1),k(o),y(o))},k=function(a){var o=a,n=o.find("."+e.selectors.arrow_detail);n.css({"border-left-width":e.arrow_detail.arrow_size+"px","border-right-width":e.arrow_detail.arrow_size+"px","border-bottom-width":e.arrow_detail.arrow_size+"px",top:"-"+(e.arrow_detail.arrow_size-1)+"px"});var s=o.offset().left+o.width()/2-i()-e.arrow_detail.arrow_size/2,r=(t(window).width()-o.parent().parent().parent().width())/2;s-=r,n.css({left:s+"px"})},y=function(t){if(!e.has_navigation)return!1;var a=t.find("."+e.selectors.content),o=t.find("."+e.selectors.button_next),n=t.find("."+e.selectors.button_prev);if("none"!==e.navigation_position&&(o.css({position:"absolute",top:"auto",bottom:"0px",right:"0px"}),n.css({position:"absolute",top:"auto",bottom:"0px",left:"0px"})),"top"===e.navigation_position&&(o.css({top:"0px",bottom:"auto"}),n.css({top:"0px",bottom:"auto"})),"bottom"===e.navigation_position&&(o.css({top:"auto",bottom:"0px"}),n.css({top:"auto",bottom:"0px"})),"middle"===e.navigation_position){var i=a.height()/2;h_next=i-o.height()/2,h_prev=i-n.height()/2,o.css({top:h_next+"px",bottom:"auto"}),n.css({top:h_prev+"px",bottom:"auto"})}},A=function(a){var o=a;if("none"===e.go_to_type)return!1;var n=o.offset().top;"top-thumb"===e.go_to_type&&(n=o.offset().top),"middle-thumb"===e.go_to_type&&(n=o.offset().top+o.height()/2),"top-content"===e.go_to_type&&(n=n=o.find("."+e.selectors.content).offset().top);var i=n;0===e.speeds.go_to_opened?t("html, body").scrollTop(i):t("html, body").animate({scrollTop:i},e.speeds.go_to_opened)};t.fn.wmGridMaster=function(n){var i=this;e=t.extend(!0,o,n),a={CB_beforeInitGrid:function(){t.isFunction(e.callbacks.CB_beforeInitGrid)&&e.callbacks.CB_beforeInitGrid.apply(this,arguments)},CB_afterInitGrid:function(){t.isFunction(e.callbacks.CB_afterInitGrid)&&e.callbacks.CB_afterInitGrid.apply(this,arguments)},CB_beforeLoadAjax:function(){t.isFunction(e.callbacks.CB_beforeLoadAjax)&&e.callbacks.CB_beforeLoadAjax.apply(this,arguments)},CB_afterLoadAjax:function(){t.isFunction(e.callbacks.CB_afterLoadAjax)&&e.callbacks.CB_afterLoadAjax.apply(this,arguments)},CB_beforeOpenDetail:function(){t.isFunction(e.callbacks.CB_beforeOpenDetail)&&e.callbacks.CB_beforeOpenDetail.apply(this,arguments)},CB_afterOpenDetail:function(){t.isFunction(e.callbacks.CB_afterOpenDetail)&&e.callbacks.CB_afterOpenDetail.apply(this,arguments)},CB_beforeAjaxOpenDetail:function(){t.isFunction(e.callbacks.CB_beforeAjaxOpenDetail)&&e.callbacks.CB_beforeAjaxOpenDetail.apply(this,arguments)},CB_afterAjaxOpenDetail:function(){t.isFunction(e.callbacks.CB_afterAjaxOpenDetail)&&e.callbacks.CB_afterAjaxOpenDetail.apply(this,arguments)},CB_closeDetail:function(){t.isFunction(e.callbacks.CB_closeDetail)&&e.callbacks.CB_closeDetail.apply(this,arguments)},CB_nextDetail:function(){t.isFunction(e.callbacks.CB_nextDetail)&&e.callbacks.CB_nextDetail.apply(this,arguments)},CB_prevDetail:function(){t.isFunction(e.callbacks.CB_prevDetail)&&e.callbacks.CB_prevDetail.apply(this,arguments)},CB_goToDetail:function(){t.isFunction(e.callbacks.CB_goToDetail)&&e.callbacks.CB_goToDetail.apply(this,arguments)}},e.ajax.has_ajax&&h(),e.has_detail&&(m(),g(),b(),j()),a.CB_beforeInitGrid();var s=function(){i.each(function(){var a=t(this);l(a),e.ajax.has_ajax&&(c(a),p(a)),t(window).resize(function(){l(a)}),e.has_detail&&D(i)}),t(window).load(function(){i.fadeTo(300,1),a.CB_afterInitGrid()}),t(window).resize(function(){e.has_detail&&D(i)})},r=function(t,e){var a=t,o=e;x(a,o)},d=function(t){var a=t,o=a.find("."+e.selectors.item+"."+e.selectors.item_opened);B(o)};return{init:s,goTo:r,closeDetail:d}}}(jQuery);